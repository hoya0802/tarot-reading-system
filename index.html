<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”® íƒ€ë¡œ ë¦¬ë”© ì‹œìŠ¤í…œ</title>
    
    <!-- CSS íŒŒì¼ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/tarot.css">
    
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.skypack.dev/@supabase/supabase-js"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”®</text></svg>">
</head>
<body>
    <div id="app">
        <!-- ë¡œë”© í™”ë©´ -->
        <div v-if="isLoading" class="loading-screen">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <h2>íƒ€ë¡œ ë¦¬ë”© ì‹œìŠ¤í…œ ë¡œë”© ì¤‘...</h2>
                <p>{{ loadingMessage }}</p>
            </div>
        </div>

        <!-- ì„¤ì • ì•ˆë‚´ í™”ë©´ -->
        <div v-if="showSetupGuide" class="setup-guide">
            <div class="setup-content">
                <h1>ğŸ”® íƒ€ë¡œ ë¦¬ë”© ì‹œìŠ¤í…œ ì„¤ì •</h1>
                <div class="setup-steps">
                    <h3>ì„¤ì • ë‹¨ê³„:</h3>
                    <ol>
                        <li>Supabase í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ì„¸ìš”</li>
                        <li>ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¥¼ ì„¤ì •í•˜ì„¸ìš”</li>
                        <li>Supabase ì—°ê²° ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”</li>
                        <li>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”</li>
                    </ol>
                </div>
                <div class="setup-help">
                    <h3>ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
                    <p>README.md íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.</p>
                    <button @click="checkConnection" class="btn btn-primary">ì—°ê²° í™•ì¸</button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ -->
        <div v-if="!isLoading && !showSetupGuide" class="main-app">
            <!-- í—¤ë” -->
            <header class="app-header">
                <h1>ğŸ”® íƒ€ë¡œ ë¦¬ë”© ì‹œìŠ¤í…œ</h1>
                <p>ë‹¹ì‹ ì˜ ìš´ëª…ì„ ì¹´ë“œë¡œ ì½ì–´ë³´ì„¸ìš”</p>
            </header>

            <!-- ë©”ì¸ ì»¨í…ì¸  -->
            <main class="app-main">
                <!-- ëª©ì  ì„ íƒ -->
                <purpose-selector 
                    v-if="currentStep === 'purpose'"
                    @purpose-selected="onPurposeSelected">
                </purpose-selector>

                <!-- íƒ€ë¡œ ë± -->
                <tarot-deck 
                    v-if="currentStep === 'deck'"
                    :cards="cards"
                    @selection-complete="onCardSelectionComplete">
                </tarot-deck>

                <!-- ì¹´ë“œ ìŠ¤í”„ë ˆë“œ -->
                <card-spread 
                    v-if="currentStep === 'spread'"
                    :selectedCards="selectedCards"
                    @start-reading="onStartReading"
                    @reshuffle="onReshuffle">
                </card-spread>

                <!-- ë¦¬ë”© ê²°ê³¼ -->
                <reading-result 
                    v-if="currentStep === 'result'"
                    :readingData="readingData"
                    @new-reading="onNewReading">
                </reading-result>

                <!-- ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ -->
                <user-history 
                    v-if="currentStep === 'history'"
                    @back-to-main="currentStep = 'purpose'">
                </user-history>
            </main>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav class="app-nav">
                <button @click="currentStep = 'purpose'" class="nav-btn">ğŸ  í™ˆ</button>
                <button @click="currentStep = 'history'" class="nav-btn">ğŸ“š íˆìŠ¤í† ë¦¬</button>
                <button @click="showConnectionStatus" class="nav-btn">ğŸ”— ì—°ê²° ìƒíƒœ</button>
            </nav>
        </div>
    </div>

    <!-- JavaScript íŒŒì¼ë“¤ -->
    <script type="module" src="js/services/supabase.js"></script>
    <script type="module" src="js/utils/cardUtils.js"></script>
    <script type="module" src="js/services/tarotService.js"></script>
    <script type="module" src="js/components/PurposeSelector.js"></script>
    <script type="module" src="js/components/TarotDeck.js"></script>
    <script type="module" src="js/components/CardSpread.js"></script>
    <script type="module" src="js/components/ReadingResult.js"></script>
    <script type="module" src="js/components/UserHistory.js"></script>
    
    <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        import supabase, { checkSupabaseConnection, showSetupGuide } from './js/services/supabase.js';
        import { loadCards } from './js/services/tarotService.js';

        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    isLoading: true,
                    showSetupGuide: false,
                    currentStep: 'purpose',
                    selectedPurpose: null,
                    cards: [],
                    selectedCards: [],
                    readingData: null,
                    loadingMessage: 'ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...'
                };
            },
            async mounted() {
                await this.initializeApp();
            },
            methods: {
                async initializeApp() {
                    try {
                        this.loadingMessage = 'Supabase ì—°ê²°ì„ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                        
                        // Supabase ì—°ê²° í™•ì¸
                        await checkSupabaseConnection();
                        
                        this.loadingMessage = 'ì¹´ë“œ ë°ì´í„°ë¥¼ ë¡œë”©í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                        
                        // ì¹´ë“œ ë°ì´í„° ë¡œë“œ
                        this.cards = await loadCards();
                        
                        this.isLoading = false;
                        console.log('ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ì™„ë£Œ');
                        
                    } catch (error) {
                        console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                        this.showSetupGuide = true;
                        this.isLoading = false;
                        showSetupGuide();
                    }
                },
                
                onPurposeSelected(purpose) {
                    this.selectedPurpose = purpose;
                    this.currentStep = 'deck';
                },
                
                onCardSelectionComplete(cards) {
                    this.selectedCards = cards;
                    this.currentStep = 'spread';
                },
                
                onStartReading(cards) {
                    // ë¦¬ë”© ë¡œì§ êµ¬í˜„ ì˜ˆì •
                    this.currentStep = 'result';
                },
                
                onReshuffle() {
                    this.selectedCards = [];
                    this.currentStep = 'deck';
                },
                
                onNewReading() {
                    this.selectedPurpose = null;
                    this.selectedCards = [];
                    this.readingData = null;
                    this.currentStep = 'purpose';
                },
                
                async checkConnection() {
                    try {
                        await checkSupabaseConnection();
                        alert('ì—°ê²°ì´ ì„±ê³µí–ˆìŠµë‹ˆë‹¤!');
                        this.showSetupGuide = false;
                        await this.initializeApp();
                    } catch (error) {
                        alert('ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    }
                },
                
                showConnectionStatus() {
                    const status = this.isLoading ? 'ë¡œë”© ì¤‘' : 
                                 this.showSetupGuide ? 'ì„¤ì • í•„ìš”' : 'ì—°ê²°ë¨';
                    alert(`í˜„ì¬ ìƒíƒœ: ${status}`);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
